services:
  - type: web
    name: resonance-agent
    env: node
    rootDir: Downloads/Resonance
    buildCommand: cd resonance && npm install && npm run build
    startCommand: node resonance/dist/agent/index_secure.js
    envVars:
      - key: RESONANCE_MODE
        value: adaptive
      - key: RESONANCE_METRICS_PORT
        value: 9090
      - key: RESONANCE_HEALTH_PORT
        value: 8080
      - key: RESONANCE_API_KEY
        sync: false  # Set this manually in Render dashboard
      - key: RESONANCE_RATE_LIMIT_MAX
        value: "100"
      - key: RESONANCE_RATE_LIMIT_WINDOW_MS
        value: "60000"
      - key: RESONANCE_ALLOWED_ORIGINS
        value: https://resonance.syncscript.app
      - key: RESONANCE_ENABLE_CORS
        value: "true"
    healthCheckPath: /health
    domains:
      - api.resonance.syncscript.app

